<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
<title>Seguimiento de Procesos Escolares ¬∑ Primaria 2026</title>
<meta name="theme-color" content="#1b5e20" />
<meta name="mobile-web-app-capable" content="yes">

<style>
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { margin: 0; font-family: system-ui, Arial, sans-serif; background: #dff5e1; padding-bottom: 95px; user-select: none; }

  /* Estilos de Cabecera y Branding */
  .header { background: #1b5e20; color: #fff; text-align: center; padding: 20px 16px 35px; border-radius: 0 0 30px 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
  .header img { width: 90px; margin-bottom: 10px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); display: inline-block; }
  .header h2 { margin: 5px 0; font-size: 22px; letter-spacing: -0.5px; }
  .header h4 { margin: 5px 0; font-weight: 500; opacity: 0.9; font-size: 14px; }
  .header strong { display: block; margin-top: 8px; font-size: 15px; color: #a5d6a7; }
  .header p { margin: 5px 0 0; font-size: 13px; opacity: 0.8; }

  /* Men√∫ de Navegaci√≥n */
  .menu { display: flex; justify-content: space-around; gap: 10px; background: #2e7d32; padding: 8px; margin: -25px auto 20px; width: 92%; border-radius: 999px; box-shadow: 0 6px 12px rgba(0,0,0,0.15); position: relative; z-index: 10; }
  .menu button { flex: 1; border: none; padding: 12px 14px; border-radius: 999px; font-weight: 800; cursor: pointer; background: rgba(255,255,255,0.1); color: #fff; transition: all 0.2s; font-size: 14px; }
  .menu button.active { background: #fff; color: #1b5e20; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

  /* Contenedores y Formularios */
  .container { background: #fff; width: 92%; margin: 10px auto; padding: 20px 16px; border-radius: 18px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); }
  .input-label { font-weight: 700; color: #1b5e20; font-size: 13px; margin-left: 4px; margin-bottom: 4px; display: block; }
  input, textarea, select { width: 100%; padding: 14px; margin-bottom: 15px; border-radius: 12px; border: 2px solid #ddd; font-size: 16px; background: #f9f9f9; transition: border 0.3s; appearance: none; -webkit-appearance: none; }
  input:focus, textarea:focus, select:focus { border-color: #1b5e20; background: #fff; outline: none; }
  
  .remember-box { display: flex; align-items: center; gap: 8px; margin-bottom: 15px; font-size: 14px; color: #555; }
  .remember-box input { width: auto; margin: 0; }

  .btn { width: 100%; padding: 15px; background: #1b5e20; color: #fff; font-weight: 800; border: none; border-radius: 14px; cursor: pointer; font-size: 15px; box-shadow: 0 4px 0 #145018; margin-top: 5px; }
  .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #145018; }
  .btn.sec { background: #546e7a; box-shadow: 0 4px 0 #37474f; }
  .btn.blue { background: #0277bd; box-shadow: 0 4px 0 #01579b; }

  /* Cards de Registros */
  .card { margin-top: 15px; border-radius: 16px; overflow: hidden; border: 1px solid #eee; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; }
  .card .top { padding: 10px 12px; font-weight: 900; color: #fff; display: flex; justify-content: space-between; align-items: center; }
  .badge { padding: 4px 8px; border-radius: 6px; background: rgba(0,0,0,0.2); font-size: 11px; font-weight: 800; }
  .card .body { padding: 15px; color: #333; font-size: 14px; line-height: 1.5; }
  .row { margin-top: 10px; }
  .row b { display: block; margin-bottom: 3px; color: #1b5e20; font-size: 12px; text-transform: uppercase; }

  /* Resumen de Asistencia */
  .att-summary { display: flex; gap: 10px; margin-bottom: 15px; }
  .att-box { flex: 1; text-align: center; padding: 10px 5px; border-radius: 12px; color: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1); cursor: pointer; }
  .att-red { background: #ef4444; }
  .att-orange { background: #f97316; }
  .att-green { background: #22c55e; }
  .att-num { font-size: 22px; font-weight: 900; display: block; }
  .att-lbl { font-size: 10px; text-transform: uppercase; font-weight: 700; opacity: 0.9; }

  /* Firmas */
  .sig-wrap { margin-top: 15px; padding: 10px; border-radius: 14px; background: #f1f5f9; border: 2px dashed #b0bec5; }
  canvas { width: 100%; height: 180px; border-radius: 8px; background: #fff; touch-action: none; display: block; }

  /* Soporte y Modales */
  #modalSoporte { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 2000; display: none; overflow-y: auto; }
  .modal-header { background: #263238; color: #fff; padding: 20px; text-align: center; position: sticky; top: 0; z-index: 10; }
  .modal-header .close { position: absolute; left: 15px; top: 18px; font-size: 24px; background: none; border: none; color: #fff; }
  .modal-body { padding: 20px; max-width: 500px; margin: 0 auto; }

  .history-card { background: #fff; border: 1px solid #eee; border-radius: 15px; padding: 15px; margin-bottom: 15px; border-left: 5px solid #455a64; }
  .teacher-reply { background: #f3e5f5; border-left: 5px solid #6a1b9a; padding: 12px; border-radius: 8px; margin-top: 12px; color: #4a148c; font-size: 13px; }

  .footer { margin: 30px 18px 10px; text-align: center; font-size: 13px; font-weight: 600; color: #145018; opacity: 0.8; padding-bottom: 20px; line-height: 1.4; }
  .btn-support-trigger { display: block; width: auto; min-width: 240px; padding: 15px 25px; background: #455a64; color: #fff; font-weight: 800; border: none; border-radius: 50px; font-size: 14px; box-shadow: 0 4px 0 #263238; cursor: pointer; margin: 20px auto; }

  .success-overlay {
    display:none; position: fixed; top:0; left:0; width:100%; height:100%;
    z-index: 3000; color:white; text-align:center; padding: 40px 20px;
    justify-content:center; align-items:center; flex-direction:column;
  }
</style>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<script>
  firebase.initializeApp({
    apiKey: "AIzaSyB2MJ-jdwQeT6sOfZ21tCrFYzGiuTNOAJ8",
    authDomain: "diariodeprocesos-6f78d.firebaseapp.com",
    projectId: "diariodeprocesos-6f78d"
  });
  const db = firebase.firestore();

  // LISTADO DE ESTUDIANTES (DEBE COINCIDIR CON EL PANEL DOCENTE)
  const estudiantesValidos = [
    { doc: "1042155626", nombre: "MARTINEZ ARANGO AYLYN" },
    { doc: "1041636979", nombre: "OSORIO MU√ëOZ JERONIMO" },
    { doc: "1041636870", nombre: "GONZALEZ BETANCUR MARIA JOSE" },
    { doc: "1042155380", nombre: "GUTIERREZ CHAVARRIA JOSE LEANDRO" },
    { doc: "1041636841", nombre: "VARELAS BARRIENTOS LUCIANA" },
    { doc: "1041636641", nombre: "MARTINEZ MARTINEZ SEBASTIAN" },
    { doc: "1035922719", nombre: "MOLINA OCHOA BELEN" },
    { doc: "1067959648", nombre: "PACHECO BARRERA JOSE DANIEL" },
    { doc: "1032328826", nombre: "LOPERA CADAVID LUCIANA" },
    { doc: "1042155250", nombre: "CASAS FERNANDEZ ANTONELLA" },
    { doc: "1035801483", nombre: "RESTREPO VILLA DILMER FELIPE" },
    { doc: "1157463842", nombre: "BERRIO CORREA VALENTINA" },
    { doc: "1038213324", nombre: "GUZMAN CORREA DYLAN" },
    { doc: "1041636021", nombre: "VARELAS BARRIENTOS MAXIMILIANO" }
  ];
</script>
</head>

<body>

  <div class="header">
    <img src="escudo.png" alt="Escudo I.E. De Mar√≠a">
    <h2>Instituci√≥n Educativa de Mar√≠a</h2>
    <h4>Sede Rural Santa Juana ¬∑ Primaria 2026</h4>
    <strong>Docente: Oscar Barrientos</strong>
    <p>Seguimiento de Procesos Escolares</p>
  </div>

  <div class="menu">
    <button id="btnExc" class="active" onclick="switchTab('exc')">Excusas / Asistencia</button>
    <button id="btnObs" onclick="switchTab('obs')">Observaciones</button>
  </div>

  <!-- SECCI√ìN: ASISTENCIA Y EXCUSAS -->
  <div id="view-exc" class="container">
    <span class="input-label">DOCUMENTO DEL ESTUDIANTE</span>
    <input id="docExc" type="number" placeholder="Digite documento..." inputmode="numeric">
    <div class="remember-box">
        <input type="checkbox" id="chkRemExc">
        <label for="chkRemExc">Recordar documento</label>
    </div>
    <button id="btnInitExc" class="btn" onclick="activarFormularioExcusa()">CONTINUAR</button>

    <div id="formExc" style="display:none; margin-top:20px; border-top:1px solid #eee; padding-top:20px;">
        <div style="text-align:center; margin-bottom:15px; border:1px solid #c8e6c9; border-radius:14px; overflow:hidden;">
          <div id="nombreExc" style="font-weight:900; color:#0b2e13; background:#e8f5e9; padding:10px;"></div>
          <div id="periodoAsisLabel" style="background:#1b5e20; color:#fff; padding:5px; font-size:12px; font-weight:bold;"></div>
        </div>

        <div class="att-summary">
            <div class="att-box att-red"><span class="att-num" id="statFallas">0</span><span class="att-lbl">Fallas</span></div>
            <div class="att-box att-orange"><span class="att-num" id="statExcusas">0</span><span class="att-lbl">Excusas</span></div>
            <div class="att-box att-green"><span class="att-num" id="statEstado">OK</span><span class="att-lbl">Estado</span></div>
        </div>

        <h3 style="margin-bottom:10px; font-size:16px;">Enviar Justificaci√≥n</h3>
        <input id="fechaExc" type="date">
        <select id="motivoExc">
            <option>Enfermedad</option><option>Cita m√©dica</option><option>Calamidad</option><option>Otro</option>
        </select>
        <textarea id="detalleExc" placeholder="Describa el motivo detalladamente..."></textarea>
        <div class="sig-wrap">
          <span class="input-label" style="text-align:center">FIRMA ACUDIENTE (OBLIGATORIA)</span>
          <canvas id="sigExc"></canvas>
          <button class="btn sec" style="padding:8px; font-size:12px;" onclick="limpiarPad('sigExc')">Borrar Firma</button>
        </div>
        <button id="btnEnviarExc" class="btn" style="margin-top:15px;" onclick="enviarExcusa()">ENVIAR EXCUSA</button>
    </div>
  </div>

  <!-- SECCI√ìN: OBSERVACIONES -->
  <div id="view-obs" class="container" style="display:none;">
    <span class="input-label">DOCUMENTO DEL ESTUDIANTE</span>
    <input id="docObs" type="number" placeholder="Digite documento..." inputmode="numeric">
    <div class="remember-box">
        <input type="checkbox" id="chkRemObs">
        <label for="chkRemObs">Recordar documento</label>
    </div>
    <button class="btn" onclick="buscarObservaciones()">VER OBSERVACIONES</button>
    <div id="resultadoObs" style="margin-top:20px;"></div>
  </div>

  <!-- PORTAL DE SOPORTE -->
  <div id="modalSoporte">
    <div class="modal-header"><button class="close" onclick="cerrarSoporte()">‚úï</button>Soporte y Comunicaci√≥n</div>
    <div class="modal-body">
      <div id="sop_auth">
        <h3 style="text-align:center">Autenticaci√≥n</h3>
        <input id="docSoporte" type="number" placeholder="Documento del estudiante..." inputmode="numeric">
        <button class="btn" onclick="autenticarSoporte()">INGRESAR</button>
      </div>

      <div id="sop_menu" style="display:none">
        <div id="sop_nombre_est" style="font-weight:800; color:#1b5e20; text-align:center; margin-bottom:20px;"></div>
        <button class="btn blue" style="margin-bottom:12px">üìÖ HORARIO ESCOLAR</button>
        <button class="btn blue" style="margin-bottom:12px">üìö √öTILES ESCOLARES 2026</button>
        <button class="btn" style="margin-bottom:12px" onclick="irAFormSop()">‚úâÔ∏è COMUNICARSE CON EL DOCENTE</button>
        <button class="btn sec" style="background:#6a1b9a;" onclick="irAHistorialSop()">üì¨ VER RESPUESTAS DEL DOCENTE</button>
      </div>

      <div id="sop_form" style="display:none">
        <h3 style="margin-bottom:15px;">Nuevo Mensaje</h3>
        <input id="msg_fecha" type="date">
        <input id="msg_asunto" type="text" placeholder="Asunto (Duda, Sugerencia...)">
        <textarea id="msg_texto" placeholder="Escriba su mensaje aqu√≠..."></textarea>
        <div class="sig-wrap">
          <canvas id="sigSoporte"></canvas>
          <button class="btn sec" onclick="limpiarPad('sigSoporte')">Borrar Firma</button>
        </div>
        <button class="btn" style="margin-top:10px" onclick="enviarMensajeSoporte()">ENVIAR AL DOCENTE</button>
      </div>

      <div id="sop_history" style="display:none">
        <h3 style="color:#6a1b9a;">Mis Mensajes</h3>
        <button class="btn sec" style="padding:8px; margin-bottom:10px;" onclick="irAMenuSop()">‚Üê VOLVER</button>
        <div id="listaMensajesSop"></div>
      </div>
    </div>
  </div>

  <!-- √âXITO OVERLAYS -->
  <div id="successAsis" class="success-overlay" style="background: rgba(27, 94, 32, 0.98);">
    <h2>‚úÖ ¬°Env√≠o Exitoso!</h2>
    <p>‚ÄúRecuerda que es responsabilidad del estudiante ponerse al d√≠a con las actividades correspondientes.‚Äù</p>
    <button class="btn" style="background:white; color:#1b5e20; width:200px" onclick="location.reload()">ENTENDIDO</button>
  </div>

  <div id="successMsg" class="success-overlay" style="background: rgba(2, 119, 189, 0.98);">
    <h2>‚úÖ Mensaje Enviado</h2>
    <p>‚ÄúApreciado Padre de familia, gracias por comunicarse, procurar√© responder a su solicitud lo m√°s pronto posible.‚Äù</p>
    <button class="btn" style="background:white; color:#0277bd; width:200px" onclick="location.reload()">ENTENDIDO</button>
  </div>

  <button class="btn-support-trigger" onclick="abrirSoporte()">üí¨ Comunicaci√≥n y Soporte</button>
  
  <div class="footer">‚ÄúFamilia y escuela caminamos juntos‚Äù</div>

<script>
  let estActualDoc = "";
  let periodoAsis = 1;
  const pads = new Map();

  window.onload = function() {
    const saved = localStorage.getItem("padre_doc");
    if(saved) {
        document.getElementById("docExc").value = saved;
        document.getElementById("docObs").value = saved;
        document.getElementById("docSoporte").value = saved;
        document.getElementById("chkRemExc").checked = true;
        document.getElementById("chkRemObs").checked = true;
    }
  };

  function switchTab(t) {
    document.getElementById("view-exc").style.display = t === 'exc' ? 'block' : 'none';
    document.getElementById("view-obs").style.display = t === 'obs' ? 'block' : 'none';
    document.getElementById("btnExc").className = t === 'exc' ? 'active' : '';
    document.getElementById("btnObs").className = t === 'obs' ? 'active' : '';
  }

  // --- ASISTENCIA ---
  async function activarFormularioExcusa() {
    const docInput = document.getElementById("docExc").value.trim();
    const est = estudiantesValidos.find(e => e.doc === docInput);
    if(!est) return alert("Documento no encontrado.");
    
    if(document.getElementById("chkRemExc").checked) localStorage.setItem("padre_doc", docInput);

    estActualDoc = docInput;
    document.getElementById("btnInitExc").style.display = "none";
    document.getElementById("formExc").style.display = "block";
    document.getElementById("nombreExc").innerText = est.nombre;

    // Sincronizar Periodo
    const snapC = await db.collection("configuracionGlobal").doc("asistencia").get();
    periodoAsis = snapC.exists ? (snapC.data().periodoActual || 1) : 1;
    document.getElementById("periodoAsisLabel").innerText = "PERIODO ACTUAL #" + periodoAsis;

    consultarStats(docInput);
    initPad('sigExc');
  }

  async function consultarStats(docId) {
    const snap = await db.collection("controlAsistencia").where("periodo", "==", periodoAsis).get();
    let f=0, e=0;
    snap.forEach(d => {
        const reg = (d.data().detalles || []).find(x => x.doc === docId);
        if(reg?.estado === 'I') f++;
        if(reg?.estado === 'E') e++;
    });
    document.getElementById("statFallas").innerText = f;
    document.getElementById("statExcusas").innerText = e;
    document.getElementById("statEstado").innerText = (f+e >= 3) ? "ALERTA" : "OK";
    document.getElementById("statEstado").parentElement.style.background = (f+e >= 3) ? "#ef4444" : "#22c55e";
  }

  async function enviarExcusa() {
    const p = pads.get('sigExc');
    if(!p?.hasData) return alert("Firma obligatoria.");
    await db.collection("excusasInasistencia").add({
        documentoEstudiante: estActualDoc,
        fechaInasistencia: document.getElementById("fechaExc").value,
        motivoTipo: document.getElementById("motivoExc").value,
        motivoDetalle: document.getElementById("detalleExc").value,
        firmaAcudiente: p.c.toDataURL(),
        timestamp: new Date().toISOString()
    });
    document.getElementById("successAsis").style.display = "flex";
  }

  // --- OBSERVACIONES ---
  async function buscarObservaciones() {
    const docId = document.getElementById("docObs").value.trim();
    const out = document.getElementById("resultadoObs");
    if(document.getElementById("chkRemObs").checked) localStorage.setItem("padre_doc", docId);

    // Sincronizar Ciclo desde la colecci√≥n configuracionCiclos
    const cicloSnap = await db.collection("configuracionCiclos").doc(docId).get();
    const cicloActual = cicloSnap.exists ? (cicloSnap.data().cicloActual || 1) : 1;

    db.collection("registrosComportamentales")
      .where("documentoEstudiante", "==", docId)
      .where("ciclo", "==", cicloActual)
      .onSnapshot(snap => {
        if(snap.empty) {
            out.innerHTML = "<p style='text-align:center; font-size:13px; color:#666;'>Sin registros en el ciclo actual (#"+cicloActual+").</p>";
            return;
        }
        let html = `<p style="font-size:11px; font-weight:bold; color:#1b5e20; margin-bottom:10px;">CICLO ACTUAL: #${cicloActual}</p>`;
        snap.forEach(d => {
            const r = d.data();
            const id = d.id;
            const firmado = !!r.firmaAcudiente;
            html += `
              <div class="card">
                <div class="top" style="background:${firmado ? '#2e7d32' : '#f57c00'}">
                    <span>${r.fecha}</span><span>${firmado ? 'FIRMADO' : 'PENDIENTE'}</span>
                </div>
                <div class="body">
                    <div class="row"><b>Situaci√≥n:</b> ${r.comportamiento}</div>
                    ${!firmado ? `
                        <div class="sig-wrap">
                            <canvas id="cv_${id}"></canvas>
                            <button class="btn" style="margin-top:10px" onclick="firmarObs('${id}')">CONFIRMAR RECIBIDO</button>
                        </div>
                    ` : `<div style="text-align:right; margin-top:10px;"><img src="${r.firmaAcudiente}" style="height:50px;"></div>`}
                </div>
              </div>`;
        });
        out.innerHTML = html;
        setTimeout(() => snap.forEach(d => { if(!d.data().firmaAcudiente) initPad('cv_'+d.id); }), 300);
      });
  }

  async function firmarObs(id) {
    const p = pads.get('cv_'+id);
    if(!p?.hasData) return alert("Debe firmar.");
    await db.collection("registrosComportamentales").doc(id).update({
        firmaAcudiente: p.c.toDataURL(),
        fechaFirmaAcudiente: new Date().toISOString()
    });
    alert("‚úÖ Firma registrada.");
  }

  // --- SOPORTE ---
  let estSop = null;
  function abrirSoporte() { document.getElementById("modalSoporte").style.display = "block"; }
  function cerrarSoporte() { document.getElementById("modalSoporte").style.display = "none"; }
  
  function autenticarSoporte() {
    const docS = document.getElementById("docSoporte").value.trim();
    const est = estudiantesValidos.find(e => e.doc === docS);
    if(!est) return alert("No encontrado.");
    estSop = est;
    document.getElementById("sop_auth").style.display = "none";
    document.getElementById("sop_menu").style.display = "block";
    document.getElementById("sop_nombre_est").innerText = est.nombre;
  }

  function irAFormSop() {
    document.getElementById("sop_menu").style.display = "none";
    document.getElementById("sop_form").style.display = "block";
    document.getElementById("msg_fecha").valueAsDate = new Date();
    setTimeout(() => initPad('sigSoporte'), 200);
  }

  function irAMenuSop() {
    document.getElementById("sop_form").style.display = "none";
    document.getElementById("sop_history").style.display = "none";
    document.getElementById("sop_menu").style.display = "block";
  }

  async function enviarMensajeSoporte() {
    const p = pads.get('sigSoporte');
    if(!p?.hasData) return alert("Firma obligatoria.");
    await db.collection("comunicacionPadres").add({
        documentoEstudiante: estSop.doc,
        nombreEstudiante: estSop.nombre,
        asunto: document.getElementById("msg_asunto").value,
        mensaje: document.getElementById("msg_texto").value,
        fechaMsg: document.getElementById("msg_fecha").value,
        timestamp: new Date().toISOString()
    });
    document.getElementById("successMsg").style.display = "flex";
  }

  function irAHistorialSop() {
    document.getElementById("sop_menu").style.display = "none";
    document.getElementById("sop_history").style.display = "block";
    db.collection("comunicacionPadres")
      .where("documentoEstudiante", "==", estSop.doc)
      .onSnapshot(snap => {
        let html = "";
        snap.forEach(d => {
            const m = d.data();
            html += `<div class="history-card">
              <div style="font-size:11px; color:#666;">${m.fechaMsg}</div>
              <div style="font-weight:bold; margin:5px 0;">${m.asunto}</div>
              <div style="font-size:13px;">${m.mensaje}</div>
              ${m.respuestaDocente ? `<div class="teacher-reply"><b>Respuesta Docente:</b><br>${m.respuestaDocente}</div>` : ''}
            </div>`;
        });
        document.getElementById("listaMensajesSop").innerHTML = html || "Sin mensajes.";
    });
  }

  // --- CANVAS UTILS ---
  function initPad(id){
    const c = document.getElementById(id); if(!c) return;
    const ctx = c.getContext("2d");
    const ratio = window.devicePixelRatio || 1;
    const rect = c.getBoundingClientRect();
    c.width = rect.width * ratio; c.height = rect.height * ratio;
    ctx.setTransform(ratio,0,0,ratio,0,0);
    ctx.lineWidth = 2.5; ctx.lineCap = "round"; ctx.strokeStyle = "#000";
    let drawing=false;
    const getPos = (e) => {
      const r = c.getBoundingClientRect();
      const cx = e.touches ? e.touches[0].clientX : e.clientX;
      const cy = e.touches ? e.touches[0].clientY : e.clientY;
      return { x: cx - r.left, y: cy - r.top };
    };
    const start = (e) => { drawing=true; ctx.beginPath(); const p=getPos(e); ctx.moveTo(p.x,p.y); };
    const move = (e) => { if(!drawing)return; const p=getPos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); pads.set(id, {c, hasData:true}); };
    const stop = () => drawing=false;
    c.addEventListener("mousedown", start); c.addEventListener("mousemove", move); window.addEventListener("mouseup", stop);
    c.addEventListener("touchstart", (e)=>{e.preventDefault(); start(e);}); c.addEventListener("touchmove", (e)=>{e.preventDefault(); move(e);}); c.addEventListener("touchend", stop);
    pads.set(id, {c, hasData:false});
  }

  function limpiarPad(id) {
    const p = pads.get(id);
    if(p) {
        const ctx = p.c.getContext("2d");
        ctx.clearRect(0,0,p.c.width, p.c.height);
        pads.set(id, {c: p.c, hasData:false});
    }
  }
</script>
</body>
</html>

